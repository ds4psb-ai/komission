---
description: Auto-convert any user request to 2025-style structured prompt and execute
---

# /2025 - Komission Master Prompt System

## Project Non-Negotiables
- DB = SoR, Sheets = ops bus
- NotebookLM = Pattern Engine (outputs DB-wrapped)
- VDG/DB fixes cluster boundary
- Canvas = I/O only

## Required Docs
- docs/00_DOCS_INDEX.md
- docs/15_FINAL_ARCHITECTURE.md
- docs/03_IMPLEMENTATION_ROADMAP.md

---

## Step 1: Auto-Tag Detection

**Keywords → Tag:**

| Tag | Keywords | Phase |
|-----|----------|-------|
| `VDG_SCHEMA` | vdg, schema, microbeats, hook_genome | 1 |
| `OUTLIER_INGEST` | outlier, crawler, tiktok, youtube, instagram | 1 |
| `CLUSTERING` | cluster_id, similarity, genealogy, depth | 1 |
| `SOURCE_PACK` | source pack, mega-pack, build_notebook_source_pack | A |
| `PATTERN_PROMOTE` | PatternLibrary, promote, invariant_rules | B |
| `EVIDENCE_LOOP` | evidence, decision, snapshot | 2 |
| `CANVAS_IO` | canvas, capsule, node, reactflow | 3 |
| `O2O_FLOW` | o2o, campaign, shipment, experience | 2+ |
| `RL_LOGS` | bandit, reward, rl-lite, policy | 5 |
| `BUG_FIX` | bug, fix, error, 안됨, 문제 | any |
| `CODE_REVIEW` | review, audit, 정리, refactor | any |

**File Path → Tag:**

| Path Pattern | Tag |
|--------------|-----|
| `schemas/vdg.py`, `gemini_pipeline.py` | VDG_SCHEMA |
| `build_notebook_source_pack.py` | SOURCE_PACK |
| `ingest_notebooklm_tables.py` | DATA_TABLES_INGEST |
| `routers/outliers.py`, `crawlers/` | OUTLIER_INGEST |
| `components/canvas/` | CANVAS_IO |
| `PatternLibrary` | PATTERN_PROMOTE |
| `docs/` | DOCS_AUDIT |

**Priority (if multiple):**
SoR/DB → Pipeline → NotebookLM → UI → Docs

---

## Step 2: Apply Tagged Template

### [OUTLIER_INGEST]
```
[PERSONA] Data pipeline engineer.
[CONTEXT] Komission outlier ingestion system. SoR=DB.
[TASK] {action} for crawler/outlier pipeline.
[CONSTRAINTS] Idempotent upserts, dedupe by external_id, no ToS violations.
[FORMAT] Code + migration if needed.
[POWER] Think step-by-step. Critique for data integrity.
```

### [VDG_SCHEMA]
```
[PERSONA] Backend schema engineer.
[CONTEXT] VDG v3.x schema system. Keep compatibility.
[TASK] Update VDG schema for {fields/feature}.
[CONSTRAINTS] Update JSON schema, add Alembic revision.
[FORMAT] Schema + migration + verification.
[POWER] Think step-by-step. Critique for backward compat.
```

### [PATTERN_PROMOTE]
```
[PERSONA] Pattern synthesis engineer.
[CONTEXT] NotebookLM → PatternLibrary flow.
[TASK] {action} for pattern promotion/library.
[CONSTRAINTS] Temporal phase preserved, revision tracking, no duplicates.
[FORMAT] Code + CLI example.
[POWER] Think step-by-step. Critique for DB-wrapped output.
```

### [EVIDENCE_LOOP]
```
[PERSONA] Evidence loop specialist.
[CONTEXT] Evidence → Decision pipeline. DB=SoR, Sheets=ops bus.
[TASK] {action} for evidence/decision system.
[CONSTRAINTS] State machine flow, DecisionObject required.
[FORMAT] Code + verification.
[POWER] Think step-by-step. Critique for loop completion.
```

### [CANVAS_IO]
```
[PERSONA] React/Canvas frontend expert.
[CONTEXT] Komission Canvas. I/O only principle.
[TASK] {action} for canvas feature.
[CONSTRAINTS] Hide internals, show I/O only, mobile-first.
[FORMAT] Component + data binding.
[POWER] Think step-by-step. Critique for UX simplicity.
```

### [O2O_FLOW]
```
[PERSONA] O2O flow engineer.
[CONTEXT] Experience campaign system (instant/onsite/shipment).
[TASK] {action} for O2O feature.
[CONSTRAINTS] MVP gating, Phase 2+ scope.
[FORMAT] API + UI + DB fields.
[POWER] Think step-by-step. Critique for campaign flow.
```

### [BUG_FIX]
```
[PERSONA] Debugging specialist.
[CONTEXT] Project: Komission. Bug: {symptom}.
[TASK] Find root cause and fix.
[CONSTRAINTS] Minimal diff, no workarounds.
[FORMAT] Root cause + fix + prevention.
[POWER] Ask: root cause or symptom?
```

### [CODE_REVIEW]
```
[PERSONA] Code quality expert.
[CONTEXT] Target: {file/module}.
[TASK] Review and refactor.
[OUTPUT] 
1. Bugs/risks/missing tests (file:line)
2. Suggested fixes
3. Brief summary
```

---

## Step 3: Execute

// turbo-all

1. Detect tag from keywords or file paths
2. Apply tagged template
3. Execute with step-by-step thinking
4. Critique own output
5. Verify (syntax check, build, etc.)

---

## Output Format

```
[TAG] Selected tag + Phase
[JUSTIFICATION] Keywords/paths matched
[PROMPT] Filled template
[EXECUTION] Step-by-step work
[VERIFICATION] Tests/checks run
```
