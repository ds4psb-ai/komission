# PDR: Product Design Requirements (Komission)

**작성**: 2026-01-07  
**버전**: v1.1  
**목표**: Komission의 핵심 제품 요구사항을 고정하고, UX/기술/운영 기준을 한 문서로 합의  
**관련 문서**: [15_FINAL_ARCHITECTURE.md](docs/15_FINAL_ARCHITECTURE.md), [00_DOCS_INDEX.md](docs/00_DOCS_INDEX.md)

---

## 1) 제품 비전 및 목표 (Why)

### 1.1 핵심 비전
> **"증거 기반 바이럴 복제 엔진"**  
> 숏폼 바이럴 성공 공식을 데이터화하고, 누구나 재현 가능한 템플릿으로 제공

### 1.2 비즈니스 목표
| 목표 | 상세 | 측정 지표 |
|------|------|----------|
| **증거 기반 복제** | Parent-Kids 변주 데이터를 축적해 재현 가능한 공식화 | Pattern Lift > 2x |
| **실행 속도** | 마이크로 인플루언서가 5분 내 촬영 시작 가능한 브리프 제공 | Time-to-Shoot < 5min |
| **운영 효율** | DB SoR + Sheet 버스로 1-2인 운영 체계 구축 | 운영 FTE < 2 |
| **확장성** | NotebookLM/Opal을 Pattern Engine/가속 레이어로 두되 결과는 DB-wrapped | 클러스터 600개+ 관리 가능 |

### 1.3 차별화 요소
- **Virlo 대비**: 단순 탐색 UI가 아닌 **Evidence 기반 실행 브리프** 제공
- **기존 툴 대비**: 감이 아닌 **데이터로 증명된 패턴**만 템플릿화
- **에이전시 대비**: 휴먼 의존도 최소화, **자동화 파이프라인** 중심

---

## 2) 범위 (Scope)

### 2.1 MVP (Week 1-4)
| 기능 | 설명 | 우선순위 |
|------|------|----------|
| **Outlier 수집** | 수동 링크 + 구독 CSV + YouTube API | P0 |
| **영상 분석** | Gemini 3.0 Pro 기반 스키마 추출 (Structured Output) | P0 |
| **클러스터링** | 유사도 기반 Parent-Kids 구조 자동 생성 | P0 |
| **Notebook Library** | 분석 스키마 + NotebookLM Pattern Engine 결과(DB-wrapped) 저장 | P0 |
| **Evidence Loop** | VDG + Progress + Decision 자동 생성 | P0 |
| **Canvas 템플릿** | 노드 기반 템플릿 실행 (입출력만 노출) | P1 |
| **Opal 시드** | 템플릿 초안 자동 생성 (선택 기능) | P2 |
| **O2O 게이팅** | 즉시/방문/배송 타입 UI 표시 | P2 |

### 2.2 Phase 2+ (고도화)
| 기능 | 설명 | 예상 시기 |
|------|------|----------|
| **제품 체험단 운영** | 모집 → 선정 → 배송/방문 → 촬영 → 성과 수집 | Week 4+ |
| **브랜드 대시보드** | 캠페인 성과/ROI 리포트 | Week 6+ |
| **RL-lite 정책** | 템플릿 기본값 자동 개선 | Week 8+ |
| **다국어 지원** | 영어/일본어 UI | TBD |

### 2.3 명시적 제외 (Out of Scope)
- ❌ 대규모 RAG 인프라 (벡터 DB 다중 인덱스)
- ❌ 완전 자동화된 RL (대형 에이전트 기반)
- ❌ 외부 플랫폼 계정 자동 조작 (ToS 위반)
- ❌ 실시간 스트리밍 분석

---

## 3) 사용자 정의 (Personas)

### 3.1 Curator/Admin (내부 운영자)
| 속성 | 설명 |
|------|------|
| **역할** | Outlier 수집/선별, Parent 승격, 증거 확인, 템플릿 QA |
| **목표** | 주당 10개+ 유효 Parent 발굴, Evidence 품질 유지 |
| **Pain Point** | 수동 작업 과다, 판단 기준 불명확 |
| **주요 화면** | `/outliers`, `/canvas`, Admin Dashboard |

### 3.2 Creator (마이크로 인플루언서)
| 속성 | 설명 |
|------|------|
| **역할** | 템플릿 기반 촬영 실행, 영상 제출, 성과 확인 |
| **목표** | 빠른 촬영, 높은 완료율, 보상 획득 |
| **Pain Point** | 뭘 찍어야 할지 모름, 가이드 부족 |
| **주요 화면** | `/remix/[nodeId]`, `/my`, `/wizard` |
| **디바이스** | 📱 모바일 웹 (촬영 기능은 모바일 전용) |

### 3.3 Brand/O2O (광고주/파트너)
| 속성 | 설명 |
|------|------|
| **역할** | 캠페인 등록, 타입 설정, 성과 관리 |
| **목표** | 비용 효율적 바이럴 콘텐츠 확보 |
| **Pain Point** | 결과 예측 불가, 크리에이터 매칭 어려움 |
| **주요 화면** | Brand Dashboard (Phase 2+) |

---

## 4) 핵심 사용자 흐름 (User Journeys)

### 4.1 Curator 플로우 (MVP)
```
Outlier 발견 → 수동/구독 등록 → 분석 파이프라인 자동 실행
    ↓
분석 스키마 확인 → 클러스터 할당 → Notebook Library 저장
    ↓
유망 Outlier → Parent 승격 → Depth 실험 시작
    ↓
Evidence 생성 → Decision 확인 → 템플릿 배포
```

### 4.2 Creator 플로우 (MVP)
```
템플릿 선택 (/canvas 또는 추천) → 촬영 가이드 확인
    ↓
📱 모바일에서 "촬영 시작" → 가이드 따라 촬영
    ↓
촬영 완료 → 영상 업로드 → 성과 추적
    ↓
K-Success 달성 시 → 포인트/배지 획득
```

> ⚠️ **촬영 기능은 모바일 웹에서만 활성화됩니다.** 데스크톱에서는 "모바일에서 촬영하세요" 안내가 표시됩니다.

### 4.3 제품 체험단 플로우 (Phase 2+)
```
Brand: 캠페인 등록 (배송/방문/즉시 타입 선택)
    ↓
Creator: 지원 신청 → 선정 결과 확인
    ↓
제품 수령 (배송) 또는 방문 일정 확정
    ↓
촬영 가이드 따라 제작 → 제출 → 성과 기록
```

---

## 5) 기능 요구사항 (Functional Requirements)

### 5.1 수집/분석 파이프라인

#### FR-001: Outlier 수집
| 요구사항 | 상세 |
|----------|------|
| 수동 등록 | URL 붙여넣기 → 메타데이터 자동 추출 |
| 구독 CSV | 외부 크롤러 결과 일괄 업로드 |
| YouTube API | 채널/키워드 기반 자동 수집 |
| 중복 제거 | URL hash + 플랫폼 ID 기준 |
| 상태 관리 | pending → selected → promoted |

#### FR-002: 영상 분석
| 요구사항 | 상세 |
|----------|------|
| 분석 엔진 | Gemini 3.0 Pro (단일 모델 고정) |
| 출력 형식 | JSON Schema 강제 (Structured Output) |
| 분석 항목 | Hook, Shots, Audio, Timing, Keywords |
| 스키마 버전 | v1.0 (마이그레이션 지원) |

#### FR-003: 클러스터링
| 요구사항 | 상세 |
|----------|------|
| 유사도 계산 | Microbeat sequence 30%, Hook 유형 25%, 시각 패턴 20%, 오디오 15%, 타이밍 10% |
| 클러스터 할당 | 유사도 75%+ → 기존 클러스터, 미만 → 신규 생성 |
| 통계 업데이트 | member_count, avg_outlier_score 자동 갱신 |

### 5.2 Evidence Loop

#### FR-004: Evidence 생성
| 요구사항 | 상세 |
|----------|------|
| 자동 생성 주기 | 주 1회 (또는 수동 트리거) |
| Progress 추적 | 14일 일별 지표 |
| Pattern Lift | (변주 성과 / Parent 성과) 계산 |
| Sheet 동기화 | DB → Google Sheets 자동 업로드 |

#### FR-005: Decision 생성
| 요구사항 | 상세 |
|----------|------|
| 입력 | Evidence 스냅샷 + Notebook Library 요약 |
| 출력 | 다음 Depth 추천, 리스크 요약, 액션 아이템 |
| Opal 연동 | 선택적 Opal 프롬프트 호출 |

### 5.3 템플릿/Canvas

#### FR-006: Canvas 노드
| 요구사항 | 상세 |
|----------|------|
| 노드 타입 | Source, Evidence, Decision, Capsule, Notebook, CrawlerOutlier, TemplateSeed |
| 노출 원칙 | 입력/출력만 표시, 내부 체인 숨김 |
| 모드 분리 | Simple (가이드 중심) / Pro (상세 제어) |

#### FR-007: 템플릿 시드 (Opal)
| 요구사항 | 상세 |
|----------|------|
| 시드 타입 | capsule, guide, edit |
| 생성 방식 | Gemini 기반 프롬프트 호출 |
| 저장 | DB(SoR) → 선택적 Sheet 동기화 |

### 5.4 촬영 가이드

#### FR-008: 촬영 기능
| 요구사항 | 상세 |
|----------|------|
| 디바이스 | **모바일 웹 전용** (데스크톱 비활성화) |
| 가이드 표시 | Hook, Shotlist, Audio, Timing 순차 표시 |
| 완료 처리 | 업로드 → 상태 변경 → 포인트 지급 |

### 5.5 제품 체험단 (Phase 2+)

#### FR-009: 캠페인 관리
| 요구사항 | 상세 |
|----------|------|
| 캠페인 타입 | 즉시(디지털), 방문(오프라인), 배송(제품) |
| MVP 범위 | **타입 게이팅 UI 표시만** |
| Phase 2+ | 모집/선정/배송/방문/제출 전체 운영 |

### 5.6 Creator Persona (Phase 3)

#### FR-010: 암묵 신호 기반 스타일 추정
| 요구사항 | 상세 |
|----------|------|
| 신호 | 행동 로그 + 템플릿 선택 + 변주 결과 |
| 자기선택 | 금지 (사용자에게 톤/성향 입력 요구 없음) |
| 보정 | 1분 Taste Calibration (페어 선택) |
| 활용 | `persona_context_json` → 캡슐 입력으로 주입 |

---

## 6) 비기능 요구사항 (Non-Functional Requirements)

### 6.1 성능
| 항목 | 목표 |
|------|------|
| Outlier 목록 로딩 | < 1초 (캐시 활용) |
| 분석 파이프라인 | < 30초/영상 |
| Canvas 렌더링 | 60fps 유지 |

### 6.2 확장성
| 항목 | 목표 |
|------|------|
| 클러스터 수 | 600개+ 관리 가능 |
| NotebookLM 분할 | 클러스터당 별도 폴더 |
| 동시 사용자 | 100+ (MVP) |

### 6.3 보안
| 항목 | 요구사항 |
|------|----------|
| 캡슐 내부 체인 | 사용자에게 숨김 처리 |
| 민감 데이터 | API 키, 인증 토큰 노출 금지 |
| 인증 | Firebase Auth (Google OAuth) |

### 6.4 운영성
| 항목 | 요구사항 |
|------|----------|
| SoR | DB 단일 진실 (Sheets는 공유 버스) |
| 로깅 | 주요 파이프라인 단계별 로그 |
| 모니터링 | 에러율, 분석 성공률 대시보드 |

---

## 7) SoR 규칙 (필수 준수)

> ⚠️ **이 규칙은 모든 기능 구현에서 반드시 준수해야 합니다.**

| 규칙 | 상세 |
|------|------|
| **DB = SoR** | 분석 스키마, 클러스터, 결정, 템플릿 시드는 DB에만 기록 |
| **Sheets = 버스** | 운영/공유용 표, 휴먼 리뷰 전용 |
| **NotebookLM/Opal 래핑** | 출력 결과는 반드시 DB에 저장 후 사용 |
| **정적 스냅샷** | NotebookLM 소스는 정적, 클러스터 분할 필요 |
| **Structured Output** | JSON Schema 강제로 재현성 확보 |

---

## 8) 성공 지표 (MVP)

### 8.1 핵심 KPI
| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| Evidence 생성 시간 | < 24시간 | Outlier 등록 → Evidence 생성까지 |
| Parent Depth 실험 | 2개+ 완료 | Depth 2 도달 Parent 수 |
| 템플릿 완료율 | > 60% | 시작 → 제출 완료 비율 |
| Pattern Lift | > 2x | 변주 성과 / Parent 성과 |

### 8.2 보조 지표
| 지표 | 목표 |
|------|------|
| 일일 Outlier 등록 | 20개+ |
| 분석 성공률 | > 95% |
| Creator 재방문율 | > 40% |

---

## 9) 위험 및 대응 계획

| 위험 | 영향 | 대응 |
|------|------|------|
| **NotebookLM 소스 제한** | 클러스터 확장 시 병목 | 클러스터 분할 전략 + 요약 캐싱 |
| **TikTok/IG API 제한** | 공식 API 사용 불가 | 구독 크롤러(Apify) 활용 |
| **분석 스키마 오류** | 클러스터 품질 저하 | 샘플링 QA + 재분석 파이프라인 |
| **Gemini API 장애** | 분석 중단 | 목업 폴백 + 큐 재시도 |
| **Creator 이탈** | 완료율 저하 | 가이드 개선 + 인센티브 강화 |

---

## 10) 의존성 및 제약사항

### 10.1 외부 의존성
| 서비스 | 용도 | 대체 계획 |
|--------|------|----------|
| Gemini API | 영상 분석, 시드 생성 | 목업 폴백 |
| Firebase Auth | 사용자 인증 | - |
| Google Sheets API | 공유 버스 | DB 직접 조회 UI |
| Apify | TikTok/IG 크롤링 | 수동 등록 |

### 10.2 기술 제약
- 촬영 기능: 모바일 웹 전용 (데스크톱 미지원)
- NotebookLM: 정적 소스, 소스당 용량 제한
- Canvas: @xyflow/react 기반 (React 18+)

---

## 11) 승인 및 변경 관리

### 변경 시 필수 업데이트
이 문서의 내용이 변경되면 반드시 아래 문서를 함께 수정해야 합니다:
- `docs/15_FINAL_ARCHITECTURE.md` - 아키텍처 정합성
- `docs/00_DOCS_INDEX.md` - 문서 의존관계
- `docs/03_IMPLEMENTATION_ROADMAP.md` - 로드맵 반영

### 버전 히스토리
| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0 | 2026-01-07 | 초안 작성 |
| v1.1 | 2026-01-07 | 체험단 Phase 2+ 분리, 모바일 촬영 명시, 상세화 |
